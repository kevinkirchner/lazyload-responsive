/*! lazyload-responsive - v0.2.1 - 2013-05-05
* Copyright (c) 2013 Kevin Kirchner; Licensed BSD */
(function(t,e){var i={srcAttr:"data-lzld-src",offset:200,highResThreshold:1.5,throttleInterval:20,useGlobalImgConfig:!1,findSmallerImgs:!0,imgConfig:{highressuffix:"@2x",loadevent:["scroll","resize"],longfallback:!0,lowres:!1,sizedown:!1,widthfactor:200}},a=!1;contentLoaded(t,function(){a=!0});var r={_o:i,_f:{},imgs:[],loadImgsQ:[],loadedImgs:[],requestingBaseImgSrc:[],availableImgSrc:[],unavailableImgSrc:[],xmlhttp:[],initialize:function(){var t=this;t._f.isHighRes=t._u.getPixelRatio()>=t._o.highResThreshold,t.collectImgs(),t.loadImgs(),t.attachEvents()},collectImgs:function(){for(var t=this,i=e.getElementsByTagName("img"),a=0,r=i.length;r>a;a++)if(null!==i[a].getAttribute(t._o.srcAttr)){var s=i[a];-1===t._u.inArray(s,t.imgs)&&t.imgs.push(s),!s.getAttribute("data-lzld-complete")&&t._u.isVisible(s)&&t.loadImgsQ.push(s)}},loadImgs:function(){var t=this;t.loadImgsQ.reverse();for(var e=t.loadImgsQ.length-1;e>=0;e--){var i=t.loadImgsQ[e],a=t.getImgData(i);t.requestImg(a),t.loadImgsQ.splice(e,1)}},resizeImgs:function(){for(var t=this,e=0,i=t.loadedImgs.length;i>e;e++){var a=t.loadedImgs[e];a.aliasArray=t.getAliasArray(a._e.img,a._o)}},attachEvents:function(){var e=this,i=e._u.getViewport("Width"),a=e._u.throttle(function(){e.collectImgs(),e.loadImgs()},20),r=e._u.throttle(function(){e.resizeImgs()},20);e._u.addEvent(t,"resize",function(){var t=e._u.getViewport("Width");(e._o.findSmallerImgs||t>i)&&r(),t>i&&a(),i=t}),e._u.addEvent(t,"scroll",function(){a()})},getImgData:function(t){var e=this,i=e.getImgConfig(t),a=t.getAttribute("data-lzld-isparsed")?e.getStoredParsedImgSrc(t):e.getParsedImgSrc(t),r=e.getAliasArray(t,i),s={_e:{img:t},_o:i,_p:a,aliasArray:r};return s},getImgConfig:function(t){var e=this;return e._o.useGlobalImgConfig?e._o.imgConfig:{highressuffix:t.getAttribute("data-lzld-highressuffix")||e._o.imgConfig.highressuffix,loadevent:t.getAttribute("data-lzld-loadevent")||e._o.imgConfig.loadevent,longfallback:t.getAttribute("data-lzld-longfallback")||e._o.imgConfig.longfallback,lowres:t.getAttribute("data-lzld-lowres")||e._o.imgConfig.lowres,sizedown:t.getAttribute("data-lzld-sizedown")||e._o.imgConfig.sizedown,widthfactor:t.getAttribute("data-lzld-widthfactor")||e._o.imgConfig.widthfactor}},getStoredParsedImgSrc:function(t){return{filePath:t.getAttribute("data-lzld-filepath"),fileName:t.getAttribute("data-lzld-filename"),fileExt:t.getAttribute("data-lzld-fileext"),aliasBase:t.getAttribute("data-lzld-aliasbase"),baseSrc:t.getAttribute("data-lzld-basesrc")}},getParsedImgSrc:function(t){var e=this,i=t.getAttribute(e._o.srcAttr),a=i.lastIndexOf("/")+1,r=i.substring(0,a),s=i.substring(a),n=s.lastIndexOf("."),l=s.substring(0,n),o=s.substring(n);return t.setAttribute("data-lzld-filepath",r),t.setAttribute("data-lzld-filename",l),t.setAttribute("data-lzld-fileext",o),t.setAttribute("data-lzld-aliasbase",r+l),t.setAttribute("data-lzld-basesrc",r+l+o),t.setAttribute("data-lzld-isparsed","true"),{filePath:r,fileName:l,fileExt:o,aliasBase:r+l,baseSrc:r+l+o}},getAliasArray:function(t,e){var i=this,a=[],r=i._f.isHighRes&&!e.lowres,s=i._u.getViewport("Width"),n=Math.floor(s/e.widthfactor),l=e.sizedown?(n+1)*e.widthfactor:n*e.widthfactor;if(r&&a.push("_"+l+e.highressuffix),a.push("_"+l),e.longfallback)for(var o=n-1;o>=0;o--){var g=e.sizedown?(o+1)*e.widthfactor:o*e.widthfactor;g>0&&(r&&a.push("_"+g+e.highressuffix),a.push("_"+g))}return r&&a.push("_small"+e.highressuffix),a.push("_small"),r&&a.push(e.highressuffix),a.push(""),a},requestImg:function(t){var e=this;if(t.aliasArray.length&&-1===e._u.inArray(t._p.baseSrc,e.requestingBaseImgSrc)){var i=t._p.aliasBase+t.aliasArray[0]+t._p.fileExt;if(t.aliasArray.splice(0,1),e.requestingBaseImgSrc.push(t._p.baseSrc),-1!==e._u.inArray(i,e.availableImgSrc))return e.requestSuccess(i,t),void 0;-1!==e._u.inArray(i,e.unavailableImgSrc)?e.requestImg(t):e.sendImgRequest(i,t)}},sendImgRequest:function(e,i){var a=this,r=a.xmlhttp.length;a.xmlhttp[r]=t.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a.xmlhttp[r].onreadystatechange=function(){4==a.xmlhttp[r].readyState&&(a.requestingBaseImgSrc.splice(a.requestingBaseImgSrc.indexOf(i._p.baseSrc),1),200==a.xmlhttp[r].status?(a.availableImgSrc.push(e),a.requestSuccess(e,i)):(a.unavailableImgSrc.push(e),a.requestImg(i)))},a.xmlhttp[r].open("GET",e,!1),a.xmlhttp[r].send()},requestSuccess:function(t,e){var i=this,a=e._e.img;a.src=t,i.loadedImgs.push(e)}};r._u={lzld:r,_o:i,throttle:function(t,e){var i=0;return function(){var a=+new Date;e>a-i||(i=a,t.apply(this,arguments))}},addEvent:function(t,e,i){t.attachEvent?t.attachEvent&&t.attachEvent("on"+e,i):t.addEventListener(e,i,!1)},removeEvent:function(t,e,i){t.detachEvent?t.detachEvent&&t.detachEvent("on"+e,i):t.removeEventListener(e,i,!1)},inArray:function(t,e,i){var a;if(e){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t,i);for(a=e.length,i=i?0>i?Math.max(0,a+i):i:0;a>i;i++)if(i in e&&e[i]===t)return i}return-1},isVisible:function(t){var i=this,a=i.getViewport("Height");return i.contains(e.documentElement,t)&&t.getBoundingClientRect().top<a+i._o.offset},getViewport:function(i){return e.documentElement["client"+i]>=0?e.documentElement["client"+i]:e.body&&e.body["client"+i]>=0?e.body["client"+i]:t["inner"+i]>=0?t["inner"+i]:0},contains:function(t,i){if(e.documentElement.compareDocumentPosition)return!!(16&t.compareDocumentPosition(i));if(e.documentElement.contains)return t!==i&&(t.contains?t.contains(i):!1);for(;i=i.parentNode;)if(i===t)return!0;return!1},getPixelRatio:function(){return t.devicePixelRatio?t.devicePixelRatio:1}},t.LazyloadResponsive=r,a?t.LazyloadResponsive.initialize():contentLoaded(t,function(){t.LazyloadResponsive.initialize()})})(this,document);